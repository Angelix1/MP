(function(c,f,u,h,a,E,L,A,m,y){"use strict";const P=u.findByProps("getChannel","getDMFromUserId"),S=u.findByProps("_channelMessages"),U=u.findByProps("getMessage","getMessages");function k(r){return f.before("dispatch",a.FluxDispatcher,function(l){if(c.isEnabled)try{const n=l[0];if(!n||!n.type)return;if(n.type==="MESSAGE_DELETE"){if(n.otherPluginBypass)return;const e=S.get(n.channelId)?.get(n.id);if(!e?.author?.id||!e.author.username||e?.author?.bot&&e?.flags==64||e.author.bot||!e.content&&!e.attachments?.length&&!e.embeds?.length)return;const t=r.get(n.id);if(t?.stage===2){r.size>=100&&(r=new Map);return}if(t?.stage===1)return t.stage=2,t.message||l;const s=P.getChannel(e.channel_id||n.channelId)?.guild_id;return n.message={...e,content:e.content,channel_id:e.channel_id||n.channelId,guild_id:s,message_reference:e?.message_reference||e?.messageReference||null,flags:64},n.type="MESSAGE_UPDATE",n.channelId=e.channel_id||n.channelId,n.optimistic=!1,n.sendMessageOptions={},n.isPushNotification=!1,r.set(n.id,{message:l,stage:1}),l}if(n.type==="MESSAGE_UPDATE"){if(n.otherPluginBypass)return;const e=n.message;if(!e||e.author?.bot)return;const t=e.channel_id||n.channelId,s=e.id||n.id,i=U.getMessage(t,s)||S.get(t)?.get(s);if(!i?.author?.id||!i.author.username||!i.content&&!i.attachments?.length&&!i.embeds?.length||!e.content||e.content===i.content)return;let d="`[ EDITED ]`\n\n";return n.message={...e,content:`${i.content} ${d}${e.content}`,guild_id:P.getChannel(t)?.guild_id??e.guild_id,edited_timestamp:"invalid_timestamp",message_reference:e?.message_reference||i?.messageReference||null},l}}catch(n){h.showToast("[ANTIED Zero] FluxDispatcher crash \u2013 check logs"),console.error(`[ANTIED Zero] Flux patch
`,n)}})}const x=u.findByProps("sendMessage","startEditMessage");function Z(){return f.before("startEditMessage",x,function(r){if(!c.isEnabled)return;const l=b("`[ EDITED ]`\n\n"),n=new RegExp(l,"gmi"),[,,e]=r,t=e.split(n),s=t[t.length-1];r[2]=s})}const D=u.findByProps("openLazy","hideActionSheet"),G=u.findByProps("getMessage","getMessages"),z=u.findByProps("getChannel","getDMFromUserId"),Q=u.findByProps("_channelMessages"),{ActionSheetRow:I}=u.findByProps("ActionSheetRow");function M(r){return r?.props?.label?.toLowerCase?.()=="reply"}function V(){return f.before("openLazy",D,function([r,l,n]){if(c.isEnabled)try{const e=n?.message;if(l!=="MessageLongPressActionSheet"||!e)return;r.then(function(t){const s=f.after("default",t,function(i,d){try{a.React.useEffect(function(){return function(){s()}},[]);const o=L.findInReactTree(d,function(_){return _?.find?.(M)});if(!o)return d;const te=Math.max(o.findIndex(M),o.length-1);let g=null;if(e?.channel_id&&e?.id&&(g=G.getMessage(e?.channel_id,e?.id),g||(g=Q.get(e?.channel_id)?.get(e?.id))),!g)return d;const ne=b("`[ EDITED ]`\n\n"),$=new RegExp(ne,"gmi");if($.test(e.content)){const _=te||1;o.splice(_,0,a.React.createElement(I,{label:"Remove Edit History",subLabel:"Added by Antied Zero",icon:a.React.createElement(I.Icon,{source:E.getAssetIDByName("ic_edit_24px")}),onPress:function(){const C=e?.content?.split($),ae=C[C.length-1];a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...e,message_reference:e?.message_reference||e?.messageReference||null,content:`${ae}`,guild_id:z.getChannel(g.channel_id).guild_id},otherPluginBypass:!0}),D.hideActionSheet(),h.showToast("History Removed",E.getAssetIDByName("ic_edit_24px"))}}))}}catch(o){h.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet:Component Patch
`,o)}})})}catch(e){h.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet Patch
`,e)}})}const v=u.findByStoreName("UserStore"),{ScrollView:O,View:w,Image:T}=y.General,{FormArrow:j,FormRow:p,FormSection:R,FormDivider:B}=y.Forms,H=[{name:"Angel",role:"Author & Maintainer",uuid:"692632336961110087"}],W=[{name:"Moodle",role:"Quality Assurance",uuid:"807170846497570848"},{name:"Rairof",role:"Quality Assurance",uuid:"923212189123346483"},{name:"Catinette",role:"Quality Assurance",uuid:"1302022854740807730"},{name:"Win8.1VMUser",role:"Quality Assurance",uuid:"793935599702507542"}],K=[{label:"Source Code",url:"https://github.com/angelix1/MP"},{label:"Tip via PayPal",url:"https://paypal.me/alixymizuki"},{label:"Buy me a Ko-fi",url:"https://ko-fi.com/angel_wolf"}];function q(){A.useProxy(m.storage);const r=function(t){return a.url.openURL(t).catch(function(){})},l=function(t){return v?.getUser(t)||Object.values(v?.getUsers()).find(function(s){return s.id===t})||null},n=function(t){return l(t)?.getAvatarURL?.()?.replace("webp","png")||null},e=function(t){return a.React.createElement(T,{source:{uri:t},style:{width:40,height:40,borderRadius:20}})};return a.React.createElement(a.React.Fragment,null,a.React.createElement(O,null,a.React.createElement(R,{title:"Developers"},H.map(function(t,s){const i=n(t?.uuid);return a.React.createElement(p,{key:s,label:t.name,subLabel:t.role,leading:i?e(i):null})})),a.React.createElement(R,{title:"Testers"},W.map(function(t,s){const i=n(t?.uuid);return a.React.createElement(p,{key:s,label:t.name,subLabel:t.role,leading:i?e(i):null})})),a.React.createElement(B,null),a.React.createElement(R,{title:"Support & Source"},a.React.createElement(w,{style:{margin:50}},K.map(function(t,s){let i=t.icon?t.icon?.startsWith("https")?a.React.createElement(T,{source:{uri:t.icon},style:{width:120,height:40}}):a.React.createElement(p.Icon,{source:E.getAssetIDByName(t.icon)}):null;return a.React.createElement(p,{key:s,label:t.label,leading:i,trailing:a.React.createElement(j,null),onPress:function(){return r(t.url)}})}))),a.React.createElement(B,null),a.React.createElement(w,{style:{height:40}})))}const{FormRow:F}=y.Forms;function J(){A.useProxy(m.storage);const r=a.NavigationNative.useNavigation(),l=function(){r.push("VendettaCustomPage",{title:"Credits & Support",render:function(){return a.React.createElement(q)}})};return a.React.createElement(a.React.Fragment,null,a.React.createElement(F,{label:"CREDITS",subLabel:"See the people behind the plugin and ways to support its development.",onPress:l,trailing:a.React.createElement(F.Icon,{source:E.getAssetIDByName("ic_arrow_right")})}))}const b=function(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};c.isEnabled=!1;const X=new Map;let N;const Y=[[k,[X]],[V,[]],[Z,[]]];N=function(){return Y.forEach(function([r,l]){return r(...l)})}();var ee={onLoad:function(){c.isEnabled=!0},onUnload:function(){c.isEnabled=!1,N?.()},settings:J};return c.default=ee,c.regexEscaper=b,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.patcher,vendetta.metro,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.storage,vendetta.plugin,vendetta.ui.components);
