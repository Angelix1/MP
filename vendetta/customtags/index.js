(function(M,o,c,y,u,C,h,S,E,A,$){"use strict";const{Permissions:oe}=c.constants,{computePermissions:re}=u.findByProps("computePermissions","canEveryoneRole"),ne=u.findByStoreName("GuildMemberStore"),P=[c.i18n.Messages.AI_TAG,c.i18n.Messages.BOT_TAG_SERVER,c.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,c.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n.Messages.REMIXING_TAG];function D(r,e,t){var a,l;let s;if(r){const d=re({user:t,context:r,overwrites:e?.permissionOverwrites});s=Object.entries(oe).map(function(f){let[b,V]=f;return d&V?b:""}).filter(Boolean)}const n=o.storage===null||o.storage===void 0?void 0:o.storage.customTags,i=o.storage===null||o.storage===void 0?void 0:o.storage.builtInReplace,g=o.storage===null||o.storage===void 0?void 0:o.storage.builtInDefault;let R=[...i];!(o.storage===null||o.storage===void 0||(a=o.storage.toggle)===null||a===void 0)&&a.useDefaultTag&&R.push(...g),!(o.storage===null||o.storage===void 0||(l=o.storage.toggle)===null||l===void 0)&&l.useCustomTags&&R.push(...n);let F;for(const d of R){var N,x;if(!((N=d.condition)===null||N===void 0)&&N.call(d,r,e,t)||!((x=d.permissions)===null||x===void 0)&&x.some(function(f){return s?.includes(f)})){let f,b;if(o.storage.useRoleColor){var B;f=(B=ne.getMember(r?.id,t.id))===null||B===void 0?void 0:B.colorString,b=c.chroma(f).get("lab.l")<70?y.rawColors.WHITE_500:y.rawColors.BLACK_500}else{var I,w,m,v;f=d?.backgroundColor||(d==null||(w=d.colors)===null||w===void 0||(I=w.bg)===null||I===void 0?void 0:I.hex)||y.rawColors.BRAND_500,b=(d==null||(v=d.colors)===null||v===void 0||(m=v.text)===null||m===void 0?void 0:m.hex)||d.textColor||y.rawColors.BRAND_500}d.name&&(d.text=d.name),F={...d,textColor:b,backgroundColor:f,verified:typeof d.verified=="function"?d.verified(r,e,t):d.verified??!1,condition:void 0,permissions:void 0};break}}return F}const ae=u.findByName("getTagProperties",!1),le=u.findByStoreName("GuildStore"),se=u.findByStoreName("ChannelStore");function ie(){return C.after("default",ae,function(r,e){let[{message:t}]=r;if(!P.includes(e.tagText)){const a=se.getChannel(t.channel_id),l=le.getGuild(a?.guild_id),s=D(l,a,t.author);if(s)return{...e,tagText:s.text,tagTextColor:s.textColor?c.ReactNative.processColor(c.chroma(s.textColor).hex()):void 0,tagBackgroundColor:s.backgroundColor?c.ReactNative.processColor(c.chroma(s.backgroundColor).hex()):void 0,tagVerified:s.verified,tagType:void 0}}})}const U=u.findByProps("getBotLabel"),ce=U.getBotLabel,ue=u.findByStoreName("GuildStore"),de=function(r,e){let[{guildId:t,user:a}]=r;console.log(e);const l=h.findInReactTree(e.props.label,function(s){return s.type.Types});if(!l||!P.includes(ce(l.props.type))){const s=ue.getGuild(t),n=D(s,void 0,a);if(n)if(l)l.props={type:0,...n};else{const i=h.findInReactTree(e.props.label,function(g){var R;return(R=g.props)===null||R===void 0?void 0:R.lineClamp}).props.children;i.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(U.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified}))}}};function ge(){const r=[];return u.findByTypeNameAll("UserRow").forEach(function(e){return r.push(C.after("type",e,de))}),function(){return r.forEach(function(e){return e()})}}const me=u.findByName("DisplayName",!1),fe=u.findByName("HeaderName",!1),H=u.findByProps("getBotLabel"),Re=H.getBotLabel,ve=u.findByStoreName("GuildStore"),Ee=u.findByStoreName("ChannelStore");function be(){const r=[];return r.push(C.after("default",fe,function(e,t){let[{channelId:a}]=e;t.props.channelId=a})),r.push(C.after("default",me,function(e,t){let[{guildId:a,channelId:l,user:s}]=e;const n=h.findInReactTree(t,function(i){return i.type.Types});if(!n||!P.includes(Re(n.props.type))){const i=ve.getGuild(a),g=Ee.getChannel(l),R=D(i,g,s);R&&(n?n.props={type:0,...R}:h.findInReactTree(t,function(F){return F.props.style.flexDirection==="row"}).props.children.push(React.createElement(H.default,{style:{marginLeft:0},type:0,text:R.text,textColor:R.textColor,backgroundColor:R.backgroundColor,verified:R.verified})))}})),function(){return r.forEach(function(e){return e()})}}const ye=u.findByProps("GuildMemberRow"),j=u.findByProps("getBotLabel"),he=j.getBotLabel,Ce=u.findByStoreName("GuildStore");function Ae(){return C.after("type",ye.GuildMemberRow,function(r,e){let[{guildId:t,channel:a,user:l}]=r;const s=h.findInReactTree(e,function(n){return n.type.Types});if(!s||!P.includes(he(s.props.type))){const n=Ce.getGuild(t),i=D(n,a,l);i&&(s?s.props={type:0,...i}:h.findInReactTree(e,function(g){return g.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(j.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified})))}})}const Te=u.findByProps("getBotLabel");function pe(){return C.after("default",Te,function(r,e){let[{text:t,textColor:a,backgroundColor:l}]=r;const s=h.findInReactTree(e,function(n){return typeof n.props.children=="string"});t&&(s.props.children=t),a&&s.props.style.push({color:a}),l&&e.props.style.push({backgroundColor:l})})}const{openLazy:Fe,hideActionSheet:qe}=u.findByProps("openLazy","hideActionSheet");function K(r,e){if(r!=null&&e!=null)for(const t of Object.keys(e))typeof e[t]=="object"&&!Array.isArray(e[t])?(typeof r[t]!="object"&&(r[t]={}),K(r[t],e[t])):r[t]??(r[t]=e[t])}function Y(r,e){try{Fe(new Promise(function(t){return t({default:r})}),"ActionSheet",e)}catch(t){A.logger.error(t.stack),showToast("Got error when opening ActionSheet! Please check debug logs")}}function z(r){const e=r>>16&255,t=r>>8&255,a=r&255;return`#${(1<<24|e<<16|t<<8|a).toString(16).slice(1)}`}function G(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return{id:r,label:e,subLabel:t,icon:a,def:l}}({...E.General,...E.Forms});const{FormLabel:Qe,FormIcon:Xe,FormArrow:Ze,FormRow:et,FormSwitch:tt,FormSwitchRow:ot,FormSection:rt,FormDivider:nt,FormInput:at,FormRadioRow:xe}=E.Forms;function Be(r){let{perm:e,data:t}=r;var a;S.useProxy(o.storage);const[l,s]=c.React.useState(t==null||(a=t.permissions)===null||a===void 0?void 0:a.includes(e));return c.React.createElement(c.React.Fragment,null,c.React.createElement(xe,{label:e,selected:l||!1,onPress:function(){var n;!(o.storage===null||o.storage===void 0||(n=o.storage.toggle)===null||n===void 0)&&n.debug&&A.logger.log(t?.name,"Perm Change",t?.permissions),l?(t.permissions=t.permissions.filter(function(i){return i!=e}),s(!1)):(t.permissions.push(e),s(!0))}}))}const{ScrollView:Ie,View:we,Text:lt,TouchableOpacity:st,TextInput:it,Image:ct,Animated:ut}=E.General,{FormLabel:dt,FormIcon:gt,FormArrow:mt,FormRow:ft,FormSwitch:Rt,FormSwitchRow:vt,FormSection:Se,FormDivider:Et,FormInput:bt,FormRadioRow:yt}=E.Forms;u.findByName("useIsFocused");function $e(r){let{permissions:e,data:t}=r;return S.useProxy(o.storage),c.React.createElement(c.React.Fragment,null,c.React.createElement(Ie,null,c.React.createElement(Se,{title:"Permissions List"},c.React.createElement(we,{style:{margin:5,padding:10}},e.map(function(a,l){return c.React.createElement(Be,{data:t,perm:a})})))))}const{ScrollView:Ne,View:ht,Text:Ct,TouchableOpacity:J,TextInput:At,Image:W,Animated:Tt}=E.General,{FormLabel:pt,FormIcon:Ft,FormArrow:xt,FormRow:T,FormSwitch:Bt,FormSwitchRow:It,FormSection:_,FormDivider:Pe,FormInput:De,FormRadioRow:wt}=E.Forms;u.findByProps("ActionSheetTitleHeader");const q=u.findByName("CustomColorPickerActionSheet");u.findByProps("hideActionSheet");const Ge=u.findByName("useIsFocused"),Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mJsrQAAAgwBAJ9P6qYAAAAASUVORK5CYII=";function X(r){let{data:e,index:t,notBuiltIn:a=!0,builtInButEditAble:l}=r;var s,n,i,g;S.useProxy(o.storage);const R=c.NavigationNative.useNavigation();Ge();const{Permissions:F}=c.constants,N=Object.keys(F).sort();function x(m,v,d,f,b){return React.createElement(React.Fragment,null,React.createElement(De,{title:v,value:m[d],placeholder:f,onChange:function(V){return m[d]=V}}),b?React.createElement(Pe,null):void 0)}const B=function(){var m,v;return Y(q,{color:c.ReactNative.processColor(e==null||(v=e.colors)===null||v===void 0||(m=v.text)===null||m===void 0?void 0:m.hex)||0,onSelect:function(d){var f;const b=z(d);e.colors.text.hex=b,!(o.storage===null||o.storage===void 0||(f=o.storage.toggle)===null||f===void 0)&&f.debug&&A.logger.log(e?.name,"Text Color Change",b)}})},I=function(){var m,v;return Y(q,{color:c.ReactNative.processColor(e==null||(v=e.colors)===null||v===void 0||(m=v.bg)===null||m===void 0?void 0:m.hex)||0,onSelect:function(d){var f;const b=z(d);e.colors.bg.hex=b,!(o.storage===null||o.storage===void 0||(f=o.storage.toggle)===null||f===void 0)&&f.debug&&A.logger.log(e?.name,"BG Color Change",b)}})},w=function(){R.push("VendettaCustomPage",{title:"Editing Permissions Conditions",render:function(){return React.createElement($e,{permissions:N,data:e})}})};return React.createElement(React.Fragment,null,React.createElement(Ne,null,React.createElement(E.ErrorBoundary,null,React.createElement(_,{title:"Tag Information"},React.createElement(T,{label:`Index: ${t}`,subLabel:"Custom Tag Indexes"}),a&&!l?x(e,"Display Tag","name","Administrator",!0):x(e,"Display Tag","text","Moderators",!0),React.createElement(T,{label:"Tag Text Color",subLabel:"Click to Update",onPress:B,trailing:React.createElement(J,{onPress:B},React.createElement(W,{source:{uri:Q},style:{width:96,height:96,borderRadius:10,backgroundColor:(e==null||(n=e.colors)===null||n===void 0||(s=n.text)===null||s===void 0?void 0:s.hex)||"#FFF"}}))}),React.createElement(T,{label:"Tag Background Color",subLabel:"Click to Update",onPress:I,trailing:React.createElement(J,{onPress:I},React.createElement(W,{source:{uri:Q},style:{width:96,height:96,borderRadius:10,backgroundColor:a&&!l?(e==null||(g=e.colors)===null||g===void 0||(i=g.bg)===null||i===void 0?void 0:i.hex)||"#000":e?.backgroundColor}}))})),l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Edit Built-in Tag Permissions"},React.createElement(T,{label:"Click to edit",onPress:w}))),a&&!l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Permissions"},React.createElement(T,{label:"Click to setup",onPress:w}))),a&&!l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Deletion"},React.createElement(T,{label:"Click to Delete",style:{color:y.rawColors.RED_400},onPress:function(){var m,v;!(o.storage===null||o.storage===void 0||(m=o.storage.toggle)===null||m===void 0)&&m.debug&&A.logger.log("Deletion",e),o.storage===null||o.storage===void 0||(v=o.storage.customTags)===null||v===void 0||v.splice(t,1),R.pop()}}))))))}const _e=u.findByName("useIsFocused"),{ScrollView:ke,View:St,Text:$t,TouchableOpacity:Le,TextInput:Nt,Image:Pt,Animated:Dt}=E.General,{FormLabel:Gt,FormIcon:k,FormArrow:_t,FormRow:L,FormSwitch:kt,FormSwitchRow:Lt,FormSection:Me,FormDivider:O,FormInput:Mt,FormRadioRow:Ot}=E.Forms;function Oe(){var r,e,t;S.useProxy(o.storage);const a=c.NavigationNative.useNavigation();_e();const l=function(n){var i;n<0&&(n=0),o.storage.customTags[n]||(o.storage.customTags[n]={indexTag:n,name:"",colors:{text:{hex:"#FFF",int:0},bg:{hex:"#000",int:0}},permissions:[]}),!(o.storage===null||o.storage===void 0||(i=o.storage.toggle)===null||i===void 0)&&i.debug&&A.logger.log("Creation",o.storage===null||o.storage===void 0?void 0:o.storage.customTags[n]),a.push("VendettaCustomPage",{title:"Editing Custom Tag",render:function(){return React.createElement(X,{data:o.storage===null||o.storage===void 0?void 0:o.storage.customTags[n],index:n})}})},s=function(n,i,g){a.push("VendettaCustomPage",{title:"Editing Built-in Tag",render:function(){return React.createElement(X,{data:n,notBuiltIn:i,builtInButEditAble:g})}})};return React.createElement(React.Fragment,null,React.createElement(ke,{style:{flex:1}},React.createElement(Me,{title:"Custom Tags List"},React.createElement(L,{label:"Owner",subLabel:"Built-in Tags",trailing:React.createElement(k,{style:{opacity:1},source:$.getAssetIDByName("ic_edit_24px")}),onPress:function(){return s(o.storage===null||o.storage===void 0?void 0:o.storage.builtInReplace[1],!1,null)}}),React.createElement(O,null),(o.storage===null||o.storage===void 0||(r=o.storage.toggle)===null||r===void 0?void 0:r.useDefaultTag)&&((e=o.storage.builtInDefault)===null||e===void 0?void 0:e.map(function(n,i){var g;return React.createElement(React.Fragment,null,React.createElement(L,{label:n?.text,trailing:React.createElement(k,{style:{opacity:1},source:$.getAssetIDByName("ic_edit_24px")}),onPress:function(){return s(n,!1,!0)}}),i!==((g=o.storage.builtInDefault)===null||g===void 0?void 0:g.length)-1&&React.createElement(O,null))})),(t=o.storage.customTags)===null||t===void 0?void 0:t.map(function(n,i){var g;return React.createElement(React.Fragment,null,React.createElement(L,{label:n?.name,trailing:React.createElement(k,{style:{opacity:1},source:$.getAssetIDByName("ic_edit_24px")}),onPress:function(){return l(i)}}),i!==((g=o.storage.customTags)===null||g===void 0?void 0:g.length)-1&&React.createElement(O,null))}),React.createElement(L,{label:"Add New Tags",trailing:React.createElement(Le,{onPress:function(){var n;return l(o.storage===null||o.storage===void 0||(n=o.storage.customTags)===null||n===void 0?void 0:n.length)}},React.createElement(k,{style:{opacity:1},source:$.getAssetIDByName("ic_add_24px")}))}))))}const{ScrollView:Ve,View:Vt,Text:Ut,TouchableOpacity:Ue,TextInput:Ht,Image:jt,Animated:Kt}=E.General,{FormLabel:Yt,FormIcon:He,FormArrow:je,FormRow:Z,FormSwitch:Ke,FormSwitchRow:zt,FormSection:ee,FormDivider:Ye,FormInput:Jt,FormRadioRow:Wt}=E.Forms,ze=u.findByName("useIsFocused"),te=[G("useRoleColor","Use highest role color","Use top role color as backgrounds",null,!1),G("useDefaultTag","Use Default Tag","Premade ADMIN, MANAGER, MOD",null,!0),G("useCustomTags","Use custom tag","Your own ruleset",null,!1),G("debug","Send logs to debug log")];function Je(){S.useProxy(o.storage);const r=c.NavigationNative.useNavigation();ze();const e=function(){r.push("VendettaCustomPage",{title:"List of Custom Tags",render:function(){return React.createElement(Oe,null)}})};return React.createElement(React.Fragment,null,React.createElement(Ve,{style:{flex:1}},React.createElement(E.ErrorBoundary,null,React.createElement(ee,{title:"Plugin Preferences"},te.map(function(t,a){return React.createElement(React.Fragment,null,React.createElement(Z,{label:t?.label,subLabel:t?.subLabel,leading:t?.icon&&React.createElement(He,{style:{opacity:1},source:$.getAssetIDByName(t?.icon)}),trailing:React.createElement(Ke,{value:(o.storage===null||o.storage===void 0?void 0:o.storage.toggle[t?.id])||!1,onValueChange:function(l){return o.storage.toggle[t.id]=l}})}),a==te?.length-1?void 0:React.createElement(Ye,null))})),React.createElement(ee,{title:"Custom Tag"},React.createElement(Z,{label:"View List",subLabel:"Click to open list of custom tags rule you made",onPress:e,trailing:React.createElement(Ue,{onPress:e},React.createElement(je,null))})))))}K(o.storage,{toggle:{useDefaultTag:!0,useRoleColor:!1,useCustomTags:!1,debug:!1},builtInReplace:[{text:"WEBHOOK",condition:function(r,e,t){return t.isNonUserBot()}},{text:"OWNER",backgroundColor:y.rawColors.ORANGE_345,condition:function(r,e,t){return r?.ownerId===t.id}},{text:c.i18n.Messages.BOT_TAG_BOT,condition:function(r,e,t){return t.bot},verified:function(r,e,t){return t.isVerifiedBot()}}],builtInDefault:[{text:"ADMIN",backgroundColor:y.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:y.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:y.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}],customTags:[]});let p=[];var We={onLoad:function(){p.push(ie()),p.push(pe()),p.push(be()),p.push(Ae()),p.push(ge())},onUnload:function(){return p.forEach(function(r){return r()})},settings:Je};return M.default=We,Object.defineProperty(M,"__esModule",{value:!0}),M})({},vendetta.plugin,vendetta.metro.common,vendetta.ui,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.storage,vendetta.ui.components,vendetta,vendetta.ui.assets);
