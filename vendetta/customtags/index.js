(function(M,t,c,b,d,A,C,I,E,T,S){"use strict";const{Permissions:te}=c.constants,{computePermissions:oe}=d.findByProps("computePermissions","canEveryoneRole"),re=d.findByStoreName("GuildMemberStore"),P=[c.i18n.Messages.AI_TAG,c.i18n.Messages.BOT_TAG_SERVER,c.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,c.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n.Messages.REMIXING_TAG];function D(r,e,o){var a,l;let s;if(r){const u=oe({user:o,context:r,overwrites:e?.permissionOverwrites});s=Object.entries(te).map(function(v){let[R,y]=v;return u&y?R:""}).filter(Boolean)}const n=t.storage===null||t.storage===void 0?void 0:t.storage.customTags,i=t.storage===null||t.storage===void 0?void 0:t.storage.builtInReplace,g=t.storage===null||t.storage===void 0?void 0:t.storage.builtInDefault;let f=[...i];!(t.storage===null||t.storage===void 0||(a=t.storage.toggle)===null||a===void 0)&&a.useDefaultTag&&f.push(...g),!(t.storage===null||t.storage===void 0||(l=t.storage.toggle)===null||l===void 0)&&l.useCustomTags&&f.push(...n);for(const u of f){var h,N;if(!((h=u.condition)===null||h===void 0)&&h.call(u,r,e,o)||!((N=u.permissions)===null||N===void 0)&&N.some(function(v){return s?.includes(v)})){let v,R;if(t.storage.useRoleColor){var F;v=(F=re.getMember(r?.id,o.id))===null||F===void 0?void 0:F.colorString,R=c.chroma(v).get("lab.l")<70?b.rawColors.WHITE_500:b.rawColors.BLACK_500}else{var x,B,w,m;v=u?.backgroundColor||(u==null||(B=u.colors)===null||B===void 0||(x=B.bg)===null||x===void 0?void 0:x.hex),R=!(u==null||(m=u.colors)===null||m===void 0||(w=m.text)===null||w===void 0)&&w.hex||c.chroma(v).get("lab.l")<70?b.rawColors.WHITE_500:b.rawColors.BLACK_500}return{...u,textColor:R,backgroundColor:v,verified:typeof u.verified=="function"?u.verified(r,e,o):u.verified??!1,condition:void 0,permissions:void 0}}}}const ne=d.findByName("getTagProperties",!1),ae=d.findByStoreName("GuildStore"),le=d.findByStoreName("ChannelStore");function se(){return A.after("default",ne,function(r,e){let[{message:o}]=r;if(!P.includes(e.tagText)){const a=le.getChannel(o.channel_id),l=ae.getGuild(a?.guild_id),s=D(l,a,o.author);if(s)return{...e,tagText:s.text,tagTextColor:s.textColor?c.ReactNative.processColor(c.chroma(s.textColor).hex()):void 0,tagBackgroundColor:s.backgroundColor?c.ReactNative.processColor(c.chroma(s.backgroundColor).hex()):void 0,tagVerified:s.verified,tagType:void 0}}})}const V=d.findByProps("getBotLabel"),ie=V.getBotLabel,ce=d.findByStoreName("GuildStore"),ue=function(r,e){let[{guildId:o,user:a}]=r;console.log(e);const l=C.findInReactTree(e.props.label,function(s){return s.type.Types});if(!l||!P.includes(ie(l.props.type))){const s=ce.getGuild(o),n=D(s,void 0,a);if(n)if(l)l.props={type:0,...n};else{const i=C.findInReactTree(e.props.label,function(g){var f;return(f=g.props)===null||f===void 0?void 0:f.lineClamp}).props.children;i.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(V.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified}))}}};function de(){const r=[];return d.findByTypeNameAll("UserRow").forEach(function(e){return r.push(A.after("type",e,ue))}),function(){return r.forEach(function(e){return e()})}}const ge=d.findByName("DisplayName",!1),fe=d.findByName("HeaderName",!1),U=d.findByProps("getBotLabel"),me=U.getBotLabel,ve=d.findByStoreName("GuildStore"),Re=d.findByStoreName("ChannelStore");function Ee(){const r=[];return r.push(A.after("default",fe,function(e,o){let[{channelId:a}]=e;o.props.channelId=a})),r.push(A.after("default",ge,function(e,o){let[{guildId:a,channelId:l,user:s}]=e;const n=C.findInReactTree(o,function(i){return i.type.Types});if(!n||!P.includes(me(n.props.type))){const i=ve.getGuild(a),g=Re.getChannel(l),f=D(i,g,s);f&&(n?n.props={type:0,...f}:C.findInReactTree(o,function(h){return h.props.style.flexDirection==="row"}).props.children.push(React.createElement(U.default,{style:{marginLeft:0},type:0,text:f.text,textColor:f.textColor,backgroundColor:f.backgroundColor,verified:f.verified})))}})),function(){return r.forEach(function(e){return e()})}}const be=d.findByProps("GuildMemberRow"),H=d.findByProps("getBotLabel"),he=H.getBotLabel,ye=d.findByStoreName("GuildStore");function Ce(){return A.after("type",be.GuildMemberRow,function(r,e){let[{guildId:o,channel:a,user:l}]=r;const s=C.findInReactTree(e,function(n){return n.type.Types});if(!s||!P.includes(he(s.props.type))){const n=ye.getGuild(o),i=D(n,a,l);i&&(s?s.props={type:0,...i}:C.findInReactTree(e,function(g){return g.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(H.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified})))}})}const Ae=d.findByProps("getBotLabel");function Te(){return A.after("default",Ae,function(r,e){let[{text:o,textColor:a,backgroundColor:l}]=r;const s=C.findInReactTree(e,function(n){return typeof n.props.children=="string"});o&&(s.props.children=o),a&&s.props.style.push({color:a}),l&&e.props.style.push({backgroundColor:l})})}const{openLazy:pe,hideActionSheet:qe}=d.findByProps("openLazy","hideActionSheet");function K(r,e){if(r!=null&&e!=null)for(const o of Object.keys(e))typeof e[o]=="object"&&!Array.isArray(e[o])?(typeof r[o]!="object"&&(r[o]={}),K(r[o],e[o])):r[o]??(r[o]=e[o])}function j(r,e){try{pe(new Promise(function(o){return o({default:r})}),"ActionSheet",e)}catch(o){T.logger.error(o.stack),showToast("Got error when opening ActionSheet! Please check debug logs")}}function Y(r){const e=r>>16&255,o=r>>8&255,a=r&255;return`#${(1<<24|e<<16|o<<8|a).toString(16).slice(1)}`}function G(r,e){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return{id:r,label:e,subLabel:o,icon:a,def:l}}const{FormLabel:Qe,FormIcon:Xe,FormArrow:Ze,FormRow:et,FormSwitch:tt,FormSwitchRow:ot,FormSection:rt,FormDivider:nt,FormInput:at,FormRadioRow:Fe}=E.Forms;function xe(r){let{perm:e,data:o}=r;var a;I.useProxy(t.storage);const[l,s]=c.React.useState(o==null||(a=o.permissions)===null||a===void 0?void 0:a.includes(e));return c.React.createElement(c.React.Fragment,null,c.React.createElement(Fe,{label:e,selected:l||!1,onPress:function(){var n;!(t.storage===null||t.storage===void 0||(n=t.storage.toggle)===null||n===void 0)&&n.debug&&T.logger.log(o?.name,"Perm Change",o?.permissions),l?(o.permissions=o.permissions.filter(function(i){return i!=e}),s(!1)):(o.permissions.push(e),s(!0))}}))}const{ScrollView:Be,View:we,Text:lt,TouchableOpacity:st,TextInput:it,Image:ct,Animated:ut}=E.General,{FormLabel:dt,FormIcon:gt,FormArrow:ft,FormRow:mt,FormSwitch:vt,FormSwitchRow:Rt,FormSection:Ie,FormDivider:Et,FormInput:bt,FormRadioRow:ht}=E.Forms;d.findByName("useIsFocused");function Se(r){let{permissions:e,data:o}=r;return I.useProxy(t.storage),c.React.createElement(c.React.Fragment,null,c.React.createElement(Be,null,c.React.createElement(Ie,{title:"Permissions List"},c.React.createElement(we,{style:{margin:5,padding:10}},e.map(function(a,l){return c.React.createElement(xe,{data:o,perm:a})})))))}const{ScrollView:$e,View:yt,Text:Ct,TouchableOpacity:W,TextInput:At,Image:z,Animated:Tt}=E.General,{FormLabel:pt,FormIcon:Ft,FormArrow:xt,FormRow:$,FormSwitch:Bt,FormSwitchRow:wt,FormSection:_,FormDivider:Ne,FormInput:Pe,FormRadioRow:It}=E.Forms;d.findByProps("ActionSheetTitleHeader");const J=d.findByName("CustomColorPickerActionSheet");d.findByProps("hideActionSheet");const De=d.findByName("useIsFocused"),q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mJsrQAAAgwBAJ9P6qYAAAAASUVORK5CYII=";function Q(r){let{data:e,index:o,notBuiltIn:a=!0,builtInButEditAble:l}=r;var s,n,i,g;I.useProxy(t.storage);const f=c.NavigationNative.useNavigation();De();const{Permissions:h}=c.constants,N=Object.keys(h).sort();function F(m,u,v,R,y){return React.createElement(React.Fragment,null,React.createElement(Pe,{title:u,value:m[v],placeholder:R,onChange:function(Je){return m[v]=Je}}),y?React.createElement(Ne,null):void 0)}const x=function(){var m,u;return j(J,{color:c.ReactNative.processColor(e==null||(u=e.colors)===null||u===void 0||(m=u.text)===null||m===void 0?void 0:m.hex)||0,onSelect:function(v){var R;const y=Y(v);e.colors.text.hex=y,!(t.storage===null||t.storage===void 0||(R=t.storage.toggle)===null||R===void 0)&&R.debug&&T.logger.log(e?.name,"Text Color Change",y)}})},B=function(){var m,u;return j(J,{color:c.ReactNative.processColor(e==null||(u=e.colors)===null||u===void 0||(m=u.bg)===null||m===void 0?void 0:m.hex)||0,onSelect:function(v){var R;const y=Y(v);e.colors.bg.hex=y,!(t.storage===null||t.storage===void 0||(R=t.storage.toggle)===null||R===void 0)&&R.debug&&T.logger.log(e?.name,"BG Color Change",y)}})},w=function(){f.push("VendettaCustomPage",{title:"Editing Permissions Conditions",render:function(){return React.createElement(Se,{permissions:N,data:e})}})};return React.createElement(React.Fragment,null,React.createElement($e,null,React.createElement(E.ErrorBoundary,null,React.createElement(_,{title:"Tag Information"},a&&!l?F(e,"Display Tag","name","Administrator",!0):F(e,"Display Tag","text","Moderators",!0),React.createElement($,{label:"Tag Text Color",subLabel:"Click to Update",onPress:x,trailing:React.createElement(W,{onPress:x},React.createElement(z,{source:{uri:q},style:{width:96,height:96,borderRadius:10,backgroundColor:(e==null||(n=e.colors)===null||n===void 0||(s=n.text)===null||s===void 0?void 0:s.hex)||"#FFF"}}))}),React.createElement($,{label:"Tag Background Color",subLabel:"Click to Update",onPress:B,trailing:React.createElement(W,{onPress:B},React.createElement(z,{source:{uri:q},style:{width:96,height:96,borderRadius:10,backgroundColor:a&&!l?(e==null||(g=e.colors)===null||g===void 0||(i=g.bg)===null||i===void 0?void 0:i.hex)||"#000":e?.backgroundColor}}))})),l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Edit Built-in Tag Permissions"},React.createElement($,{label:"Click to edit",onPress:w}))),a&&!l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Permissions"},React.createElement($,{label:"Click to setup",onPress:w}))),a&&!l&&React.createElement(React.Fragment,null,React.createElement(_,{title:"Deletion"},React.createElement($,{label:"Click to Delete",style:{color:b.rawColors.RED_400},onPress:function(){var m,u;!(t.storage===null||t.storage===void 0||(m=t.storage.toggle)===null||m===void 0)&&m.debug&&T.logger.log("Deletion",e),t.storage===null||t.storage===void 0||(u=t.storage.customTags)===null||u===void 0||u.splice(o,1),f.pop()}}))))))}const Ge=d.findByName("useIsFocused"),{ScrollView:_e,View:St,Text:$t,TouchableOpacity:ke,TextInput:Nt,Image:Pt,Animated:Dt}=E.General,{FormLabel:Gt,FormIcon:k,FormArrow:_t,FormRow:L,FormSwitch:kt,FormSwitchRow:Lt,FormSection:Le,FormDivider:O,FormInput:Mt,FormRadioRow:Ot}=E.Forms;function Me(){var r,e,o;I.useProxy(t.storage);const a=c.NavigationNative.useNavigation();Ge();const l=function(n){var i;n<0&&(n=0),t.storage.customTags[n]||(t.storage.customTags[n]={name:"",colors:{text:{hex:"#FFF",int:0},bg:{hex:"#000",int:0}},permissions:[]}),!(t.storage===null||t.storage===void 0||(i=t.storage.toggle)===null||i===void 0)&&i.debug&&T.logger.log("Creation",t.storage===null||t.storage===void 0?void 0:t.storage.customTags[n]),a.push("VendettaCustomPage",{title:"Editing Custom Tag",render:function(){return React.createElement(Q,{data:t.storage===null||t.storage===void 0?void 0:t.storage.customTags[n],index:n})}})},s=function(n,i,g){a.push("VendettaCustomPage",{title:"Editing Built-in Tag",render:function(){return React.createElement(Q,{data:n,notBuiltIn:i,builtInButEditAble:g})}})};return React.createElement(React.Fragment,null,React.createElement(_e,{style:{flex:1}},React.createElement(Le,{title:"Custom Tags List"},React.createElement(L,{label:"Owner",subLabel:"Built-in Tags",trailing:React.createElement(k,{style:{opacity:1},source:S.getAssetIDByName("ic_edit_24px")}),onPress:function(){return s(t.storage===null||t.storage===void 0?void 0:t.storage.builtInReplace[1],!1,null)}}),React.createElement(O,null),(t.storage===null||t.storage===void 0||(r=t.storage.toggle)===null||r===void 0?void 0:r.useDefaultTag)&&((e=t.storage.builtInDefault)===null||e===void 0?void 0:e.map(function(n,i){var g;return React.createElement(React.Fragment,null,React.createElement(L,{label:n?.text,trailing:React.createElement(k,{style:{opacity:1},source:S.getAssetIDByName("ic_edit_24px")}),onPress:function(){return s(n,!1,!0)}}),i!==((g=t.storage.builtInDefault)===null||g===void 0?void 0:g.length)-1&&React.createElement(O,null))})),(o=t.storage.customTags)===null||o===void 0?void 0:o.map(function(n,i){var g;return React.createElement(React.Fragment,null,React.createElement(L,{label:n?.name,trailing:React.createElement(k,{style:{opacity:1},source:S.getAssetIDByName("ic_edit_24px")}),onPress:function(){var f;return l(t.storage===null||t.storage===void 0||(f=t.storage.customTags)===null||f===void 0?void 0:f.findIndex(function(h){return h?.name==n?.name}))}}),i!==((g=t.storage.customTags)===null||g===void 0?void 0:g.length)-1&&React.createElement(O,null))}),React.createElement(L,{label:"Add New Tags",trailing:React.createElement(ke,{onPress:function(){var n;return l(t.storage===null||t.storage===void 0||(n=t.storage.customTags)===null||n===void 0?void 0:n.length)}},React.createElement(k,{style:{opacity:1},source:S.getAssetIDByName("ic_add_24px")}))}))))}const{ScrollView:Oe,View:Vt,Text:Ut,TouchableOpacity:Ve,TextInput:Ht,Image:Kt,Animated:jt}=E.General,{FormLabel:Yt,FormIcon:Ue,FormArrow:He,FormRow:X,FormSwitch:Ke,FormSwitchRow:Wt,FormSection:Z,FormDivider:je,FormInput:zt,FormRadioRow:Jt}=E.Forms,Ye=d.findByName("useIsFocused"),ee=[G("useRoleColor","Use highest role color","Use top role color as backgrounds",null,!1),G("useDefaultTag","Use Default Tag","Premade ADMIN, MANAGER, MOD",null,!0),G("useCustomTags","Use custom tag","Your own ruleset",null,!1),G("debug","Send logs to debug log")];function We(){I.useProxy(t.storage);const r=c.NavigationNative.useNavigation();Ye();const e=function(){r.push("VendettaCustomPage",{title:"List of Custom Tags",render:function(){return React.createElement(Me,null)}})};return React.createElement(React.Fragment,null,React.createElement(Oe,{style:{flex:1}},React.createElement(E.ErrorBoundary,null,React.createElement(Z,{title:"Plugin Preferences"},ee.map(function(o,a){return React.createElement(React.Fragment,null,React.createElement(X,{label:o?.label,subLabel:o?.subLabel,leading:o?.icon&&React.createElement(Ue,{style:{opacity:1},source:S.getAssetIDByName(o?.icon)}),trailing:React.createElement(Ke,{value:(t.storage===null||t.storage===void 0?void 0:t.storage.toggle[o?.id])||!1,onValueChange:function(l){return t.storage.toggle[o.id]=l}})}),a==ee?.length-1?void 0:React.createElement(je,null))})),React.createElement(Z,{title:"Custom Tag"},React.createElement(X,{label:"View List",subLabel:"Click to open list of custom tags rule you made",onPress:e,trailing:React.createElement(Ve,{onPress:e},React.createElement(He,null))})))))}K(t.storage,{toggle:{useDefaultTag:!0,useRoleColor:!1,useCustomTags:!1,debug:!1},builtInReplace:[{text:"WEBHOOK",condition:function(r,e,o){return o.isNonUserBot()}},{text:"OWNER",backgroundColor:b.rawColors.ORANGE_345,condition:function(r,e,o){return r?.ownerId===o.id}},{text:c.i18n.Messages.BOT_TAG_BOT,condition:function(r,e,o){return o.bot},verified:function(r,e,o){return o.isVerifiedBot()}}],builtInDefault:[{text:"ADMIN",backgroundColor:b.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:b.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:b.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}],customTags:[]});let p=[];var ze={onLoad:function(){p.push(se()),p.push(Te()),p.push(Ee()),p.push(Ce()),p.push(de())},onUnload:function(){return p.forEach(function(r){return r()})},settings:We};return M.default=ze,Object.defineProperty(M,"__esModule",{value:!0}),M})({},vendetta.plugin,vendetta.metro.common,vendetta.ui,vendetta.metro,vendetta.patcher,vendetta.utils,vendetta.storage,vendetta.ui.components,vendetta,vendetta.ui.assets);
