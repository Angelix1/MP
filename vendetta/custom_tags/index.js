(function(E,y,l,u,g,f,p,N,T){"use strict";const{Permissions:S}=u.constants,{computePermissions:A}=l.findByProps("computePermissions","canEveryoneRole"),_=l.findByStoreName("GuildMemberStore"),B=[u.i18n.Messages.AI_TAG,u.i18n.Messages.BOT_TAG_SERVER,u.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,u.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,u.i18n.Messages.REMIXING_TAG],G=[{text:"WEBHOOK",condition:function(e,t,o){return o.isNonUserBot()}},{text:"OWNER",backgroundColor:f.rawColors.ORANGE_345,condition:function(e,t,o){return e?.ownerId===o.id}},{text:u.i18n.Messages.BOT_TAG_BOT,condition:function(e,t,o){return o.bot},verified:function(e,t,o){return o.isVerifiedBot()}},{text:"ADMIN",backgroundColor:f.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:f.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:f.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function R(e,t,o){let a;if(e){const r=A({user:o,context:e,overwrites:t?.permissionOverwrites});a=Object.entries(S).map(function(c){let[d,v]=c;return r&v?d:""}).filter(Boolean)}for(const r of G){var s,n;if(!((s=r.condition)===null||s===void 0)&&s.call(r,e,t,o)||!((n=r.permissions)===null||n===void 0)&&n.some(function(c){return a?.includes(c)})){var i;let c=y.storage.useRoleColor?(i=_.getMember(e?.id,o.id))===null||i===void 0?void 0:i.colorString:void 0,d=c||(r.backgroundColor??f.rawColors.BRAND_500),v=c||!r.textColor?u.chroma(d).get("lab.l")<70?f.rawColors.WHITE_500:f.rawColors.BLACK_500:r.textColor;return{...r,textColor:v,backgroundColor:d,verified:typeof r.verified=="function"?r.verified(e,t,o):r.verified??!1,condition:void 0,permissions:void 0}}}}const M=l.findByName("getTagProperties",!1),I=l.findByStoreName("GuildStore"),w=l.findByStoreName("ChannelStore");function k(){return g.after("default",M,function(e,t){let[{message:o}]=e;if(!B.includes(t.tagText)){const a=w.getChannel(o.channel_id),s=I.getGuild(a?.guild_id),n=R(s,a,o.author);if(n)return{...t,tagText:n.text,tagTextColor:n.textColor?u.ReactNative.processColor(u.chroma(n.textColor).hex()):void 0,tagBackgroundColor:n.backgroundColor?u.ReactNative.processColor(u.chroma(n.backgroundColor).hex()):void 0,tagVerified:n.verified,tagType:void 0}}})}const b=l.findByProps("getBotLabel"),m=b.getBotLabel,O=l.findByStoreName("GuildStore"),L=function(e,t){let[{guildId:o,user:a}]=e;console.log(t);const s=p.findInReactTree(t.props.label,function(n){return n.type.Types});if(!s||!B.includes(m(s.props.type))){const n=O.getGuild(o),i=R(n,void 0,a);if(i)if(s)s.props={type:0,...i};else{const r=p.findInReactTree(t.props.label,function(c){var d;return(d=c.props)===null||d===void 0?void 0:d.lineClamp}).props.children;r.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(b.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}};function D(){const e=[];return l.findByTypeNameAll("UserRow").forEach(function(t){return e.push(g.after("type",t,L))}),function(){return e.forEach(function(t){return t()})}}const P=l.findByName("DisplayName",!1),U=l.findByName("HeaderName",!1),x=l.findByProps("getBotLabel"),$=x.getBotLabel,H=l.findByStoreName("GuildStore"),K=l.findByStoreName("ChannelStore");function V(){const e=[];return e.push(g.after("default",U,function(t,o){let[{channelId:a}]=t;o.props.channelId=a})),e.push(g.after("default",P,function(t,o){let[{guildId:a,channelId:s,user:n}]=t;const i=p.findInReactTree(o,function(r){return r.type.Types});if(!i||!B.includes($(i.props.type))){const r=H.getGuild(a),c=K.getChannel(s),d=R(r,c,n);d&&(i?i.props={type:0,...d}:p.findInReactTree(o,function(v){return v.props.style.flexDirection==="row"}).props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:d.text,textColor:d.textColor,backgroundColor:d.backgroundColor,verified:d.verified})))}})),function(){return e.forEach(function(t){return t()})}}const F=l.findByProps("GuildMemberRow"),h=l.findByProps("getBotLabel"),W=h.getBotLabel,j=l.findByStoreName("GuildStore");function X(){return g.after("type",F.GuildMemberRow,function(e,t){let[{guildId:o,channel:a,user:s}]=e;const n=p.findInReactTree(t,function(i){return i.type.Types});if(!n||!B.includes(W(n.props.type))){const i=j.getGuild(o),r=R(i,a,s);r&&(n?n.props={type:0,...r}:p.findInReactTree(t,function(c){return c.props.style.flexDirection==="row"}).props.children.splice(2,0,React.createElement(h.default,{type:0,text:r.text,textColor:r.textColor,backgroundColor:r.backgroundColor,verified:r.verified})))}})}const Y=l.findByProps("getBotLabel");function q(){return g.after("default",Y,function(e,t){let[{text:o,textColor:a,backgroundColor:s}]=e;const n=p.findInReactTree(t,function(i){return typeof i.props.children=="string"});o&&(n.props.children=o),a&&n.props.style.push({color:a}),s&&t.props.style.push({backgroundColor:s})})}const{ScrollView:z}=T.General,{FormSection:J,FormSwitchRow:Q}=T.Forms;function Z(){return N.useProxy(y.storage),React.createElement(z,{style:{flex:1}},React.createElement(J,{title:"Tag style"},React.createElement(Q,{label:"Use top role color for tag backgrounds",value:y.storage.useRoleColor,onValueChange:function(e){y.storage.useRoleColor=e}})))}let C=[];var ee={onLoad:function(){var e;(e=y.storage).useRoleColor??(e.useRoleColor=!1),C.push(k()),C.push(q()),C.push(V()),C.push(X()),C.push(D())},onUnload:function(){return C.forEach(function(e){return e()})},settings:Z};return E.default=ee,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
